<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mini Miner ‚Äì styl Diamonds Explorer</title>
  <style>
    :root{ --cell:64px; --btn:48px; --mine:76px; }
    @media (max-height:700px),(max-width:420px){ :root{ --cell:56px; --btn:42px; --mine:64px; } }
    html,body{ margin:0; padding:0; height:100%; background:#0b0f16; color:#e8e8e8; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans',sans-serif; touch-action:none; user-select:none; overscroll-behavior:none; }
    canvas{ display:block; width:100vw; height:100vh; }
    #ui{ position:fixed; inset:0; pointer-events:none; }
    #hud{ position:absolute; left:8px; right:8px; top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:space-between; }
    #hud .panel{ pointer-events:auto; background:rgba(0,0,0,.45); backdrop-filter:blur(6px); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:6px 10px; display:inline-flex; align-items:center; gap:10px; font-size:12px; }
    #inv{ gap:14px; }
    #inv .item{ display:inline-flex; align-items:center; gap:6px; }
    #inv .dot{ width:12px; height:12px; border-radius:3px; border:1px solid rgba(255,255,255,.35); display:inline-block; }
    #fps{ min-width:56px; text-align:right; opacity:.85; }
    #seedPanel input{ pointer-events:auto; background:rgba(20,20,25,.7); color:#e8e8e8; border:1px solid rgba(255,255,255,.18); border-radius:8px; padding:4px 8px; font-size:12px; width:130px; }
    #seedPanel button, .topbtn, .craftBtn{ pointer-events:auto; background:#2c7ef8; color:#fff; border:none; border-radius:10px; padding:6px 10px; font-weight:600; font-size:12px; box-shadow:0 2px 6px rgba(44,126,248,.35); cursor:pointer; }
    .topbtn.toggled{ background:#21a366; box-shadow:0 2px 10px rgba(33,163,102,.45); }
  #menuWrap{ position:relative; pointer-events:auto; }
  #menuBtn{ pointer-events:auto; background:#2c7ef8; color:#fff; border:none; border-radius:10px; padding:6px 12px; font-weight:600; font-size:14px; box-shadow:0 2px 6px rgba(44,126,248,.35); cursor:pointer; }
  #menuPanel{ position:absolute; right:0; top:110%; min-width:260px; max-width:min(92vw,520px); background:rgba(15,18,26,.92); border:1px solid rgba(255,255,255,.15); border-radius:14px; padding:10px 10px 12px; display:flex; flex-direction:column; gap:10px; box-shadow:0 8px 28px -6px rgba(0,0,0,.6); backdrop-filter:blur(8px);
    /* If content taller than viewport, allow scrolling inside panel */
    max-height:calc(100vh - 90px); overflow:auto; overscroll-behavior:contain; -webkit-overflow-scrolling:touch; }
  /* Ensure the hidden attribute actually hides the panel regardless of the default display */
  #menuPanel[hidden]{ display:none !important; }
  #menuPanel .group{ display:flex; flex-wrap:wrap; gap:6px; }
  #menuPanel .hdr{ position:sticky; top:0; z-index:1; display:flex; align-items:center; justify-content:space-between; gap:8px; padding:6px 6px 8px; margin:-10px -10px 6px; border-bottom:1px solid rgba(255,255,255,.10); border-top-left-radius:14px; border-top-right-radius:14px; background:linear-gradient(180deg, rgba(18,22,30,.98), rgba(18,22,30,.92)); }
  #menuPanel .hdr .ttl{ font-weight:700; font-size:14px; letter-spacing:.2px; opacity:.95; }
  #menuPanel .hdr button{ background:rgba(255,255,255,.14); border:none; color:#fff; border-radius:8px; width:30px; height:30px; font-size:16px; cursor:pointer; }
  #menuPanel .seedRow{ align-items:center; gap:6px; font-size:12px; }
  #menuPanel input{ background:rgba(20,20,25,.7); color:#e8e8e8; border:1px solid rgba(255,255,255,.18); border-radius:8px; padding:4px 6px; font-size:12px; width:110px; }
  #menuPanel .hint{ font-size:11px; opacity:.75; }
  /* Small screens: turn into full-width sheet below top bar */
  @media (max-width:560px) {
    #menuPanel{ left:8px; right:8px; top:64px; max-width:none; width:auto; max-height:calc(100vh - 80px); }
    #menuPanel .seedRow input{ width:130px; }
  }
    #craft{ position:absolute; left:8px; top:54px; pointer-events:auto; display:flex; flex-direction:column; gap:6px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:8px; max-width:min(55vw,340px); font-size:12px; }
    #craft .req{ font-size:11px; opacity:.9; }
    #help{ position:absolute; left:8px; right:8px; top:140px; background:rgba(0,0,0,.65); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:10px 12px; font-size:12px; line-height:1.4; display:none; pointer-events:auto; }
    #controls{ position:absolute; left:0; right:0; bottom:0; padding:12px; display:flex; justify-content:space-between; gap:12px; pointer-events:none; }
    .pad{ pointer-events:auto; display:grid; gap:8px; grid-template-columns:var(--cell) var(--cell) var(--cell); grid-template-rows:var(--cell) var(--cell) var(--cell); }
    .btn{ width:var(--btn); height:var(--btn); border-radius:16px; background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.25); box-shadow:inset 0 1px 4px rgba(0,0,0,.6), 0 4px 16px rgba(0,0,0,.35); display:flex; align-items:center; justify-content:center; font-size:18px; color:#fff; }
    .btn.on, .btn:active{ background:rgba(255,255,255,.25); }
    #dirRing{ position:absolute; right:8px; bottom:8px; pointer-events:auto; display:grid; grid-template-columns:repeat(3,var(--cell)); grid-template-rows:repeat(3,var(--cell)); }
    .dircell{ display:flex; align-items:center; justify-content:center; }
    .dirbtn{ width:var(--btn); height:var(--btn); border-radius:12px; border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.10); color:#fff; font-size:16px; box-shadow:inset 0 1px 4px rgba(0,0,0,.6),0 2px 12px rgba(0,0,0,.25); }
    .dirbtn.sel{ outline:2px solid #2c7ef8; }
    #mineBtn{ width:var(--mine); height:var(--mine); border-radius:18px; font-size:24px; border:1px solid rgba(255,255,255,.3); background:linear-gradient(180deg,rgba(44,126,248,.95),rgba(29,92,204,.95)); box-shadow:0 8px 24px rgba(44,126,248,.35), inset 0 1px 3px rgba(255,255,255,.3); pointer-events:auto; }
    #mineBtn.on, #mineBtn:active{ filter:brightness(1.1); }
    #radarBtn{ position:absolute; right:8px; bottom:calc(8px + 3*var(--cell) + 10px); width:52px; height:52px; border-radius:14px; border:1px solid rgba(255,255,255,.3); background:rgba(255,255,255,.10); color:#fff; font-weight:700; box-shadow:inset 0 1px 4px rgba(0,0,0,.6),0 2px 12px rgba(0,0,0,.25); pointer-events:auto; }
    #radarBtn.pulse{ animation:radarPulse .9s infinite alternate; border-color:#4dd0ff; }
    @keyframes radarPulse{0%{ background:rgba(77,208,255,.15); box-shadow:0 0 0 rgba(77,208,255,0),0 0 16px rgba(77,208,255,.25);}100%{ background:rgba(77,208,255,.35); box-shadow:0 0 18px rgba(77,208,255,.45),0 0 28px rgba(77,208,255,.35);} }
    .pill{ background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12); border-radius:999px; padding:6px 10px; font-size:12px; }
    #errorBox{ position:absolute; left:8px; right:8px; top:50%; transform:translateY(-50%); background:#2b1e1e; color:#ffd7d7; border:1px solid #402b2b; border-radius:10px; padding:10px 12px; display:none; white-space:pre-wrap; font-family:ui-monospace,monospace; }
    #messages{ position:absolute; left:50%; top:8px; transform:translateX(-50%); font-size:12px; background:rgba(0,0,0,.5); padding:4px 10px; border-radius:999px; pointer-events:none; }
  #hotbarWrap{ position:absolute; left:50%; bottom:10px; transform:translateX(-50%); display:flex; gap:6px; pointer-events:auto; }
  .hotSlot{ width:46px; height:46px; border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.45); border-radius:10px; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:11px; position:relative; box-shadow:0 2px 8px rgba(0,0,0,.5); }
  .hotSlot.sel{ outline:2px solid #2c7ef8; }
  .hotSlot .count{ font-weight:600; }
  .hotSlot .key{ position:absolute; top:2px; right:4px; font-size:10px; opacity:.7; }
  /* Chest excitement animations */
  @keyframes chestPulseC{0%{box-shadow:0 0 0 0 rgba(176,127,44,.0);}70%{box-shadow:0 0 14px 4px rgba(176,127,44,.45);}100%{box-shadow:0 0 0 0 rgba(176,127,44,0);} }
  @keyframes chestPulseR{0%{box-shadow:0 0 0 0 rgba(167,76,201,0);}70%{box-shadow:0 0 18px 6px rgba(167,76,201,.55);}100%{box-shadow:0 0 0 0 rgba(167,76,201,0);} }
  @keyframes chestPulseE{0%{box-shadow:0 0 0 0 rgba(224,179,65,0);}70%{box-shadow:0 0 26px 9px rgba(224,179,65,.65);}100%{box-shadow:0 0 0 0 rgba(224,179,65,0);} }
  .chest-pulse-common{ animation:chestPulseC 2.8s ease-in-out infinite; }
  .chest-pulse-rare{ animation:chestPulseR 2.8s ease-in-out infinite; }
  .chest-pulse-epic{ animation:chestPulseE 2.8s ease-in-out infinite; }
  /* Loot popup */
  #lootPopup{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.9); background:rgba(15,18,26,.96); border:1px solid rgba(255,255,255,.18); border-radius:18px; padding:18px 22px 20px; width:min(540px,90vw); max-height:80vh; display:none; flex-direction:column; gap:14px; box-shadow:0 18px 60px -10px rgba(0,0,0,.7); z-index:120; color:#e8e8e8; font-size:13px; }
  #lootPopup.show{ display:flex; animation:lootIn .35s cubic-bezier(.22,.9,.3,1.1); }
  @keyframes lootIn{0%{opacity:0; transform:translate(-50%,-50%) scale(.75);}100%{opacity:1; transform:translate(-50%,-50%) scale(1);} }
  #lootPopup h3{ margin:0 0 4px; font-size:18px; }
  #lootPopup .items{ display:flex; flex-direction:column; gap:10px; overflow:auto; max-height:40vh; }
  #lootPopup .lootRow{ display:grid; grid-template-columns:1fr auto; gap:12px; padding:10px 12px; background:linear-gradient(140deg,rgba(255,255,255,.08),rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.12); border-radius:14px; position:relative; }
  #lootPopup .lootRow.epic{ border-color:rgba(224,179,65,.6); box-shadow:0 0 0 1px rgba(224,179,65,.4),0 0 26px -4px rgba(224,179,65,.5); }
  #lootPopup .lootRow.rare{ border-color:rgba(167,76,201,.55); box-shadow:0 0 0 1px rgba(167,76,201,.38),0 0 18px -4px rgba(167,76,201,.45); }
  #lootPopup .lootRow.common{ border-color:rgba(176,127,44,.45); }
  #lootPopup .lootStats{ font-size:11px; line-height:1.35; opacity:.9; }
  #lootPopup .curTag{ font-size:10px; background:rgba(255,255,255,.14); border-radius:6px; padding:2px 6px; margin-left:6px; }
  #lootPopup .diffPlus{ color:#4ade80; font-weight:600; }
  #lootPopup .diffMinus{ color:#ef4444; font-weight:600; }
  #lootPopup .btnBar{ display:flex; gap:10px; flex-wrap:wrap; }
  #lootPopup button{ background:#2c7ef8; color:#fff; border:none; border-radius:10px; padding:8px 14px; font-weight:600; cursor:pointer; font-size:12px; box-shadow:0 3px 12px rgba(44,126,248,.4); }
  #lootPopup button.sec{ background:rgba(255,255,255,.14); box-shadow:none; }
  #lootPopup button.danger{ background:#c43232; }
  #lootDim{ position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter:blur(4px); display:none; z-index:110; }
  /* Loot inbox indicator */
  #lootInboxBtn{ pointer-events:auto; background:#e0b341; color:#111; border:none; border-radius:12px; padding:6px 12px; font-weight:700; font-size:14px; box-shadow:0 2px 10px rgba(224,179,65,.45); cursor:pointer; display:none; }
  #lootInboxBtn.pulseNew{ animation:lootPulse 1.05s ease-in-out infinite; }
  #lootInboxBtn span{ margin-left:4px; }
  @keyframes lootPulse{0%{transform:scale(1); box-shadow:0 0 0 0 rgba(224,179,65,0.4);}50%{transform:scale(1.12); box-shadow:0 0 16px 4px rgba(224,179,65,0.55);}100%{transform:scale(1); box-shadow:0 0 0 0 rgba(224,179,65,0.4);} }
  </style>
</head>
<body>
  <canvas id="game" aria-label="Mini Miner"></canvas>
  <div id="ui">
    <div id="hud">
      <div id="inv" class="panel" aria-label="Ekwipunek" aria-live="polite">
        <span class="item"><span class="dot" style="background:#2e8b2e"></span> trawa: <b id="grass">0</b></span>
        <span class="item"><span class="dot" style="background:#c2b280"></span> piach: <b id="sand">0</b></span>
  <span class="item"><span class="dot" style="background:#888a90"></span> kamie≈Ñ: <b id="stone">0</b></span>
        <span class="item"><span class="dot" style="background:#3ef"></span> diamenty: <b id="diamond">0</b></span>
  <span class="item"><span class="dot" style="background:#8b5a2b"></span> drewno: <b id="wood">0</b></span>
  <span class="item"><span class="dot" style="background:#2477ff"></span> woda: <b id="water">0</b></span>
  <span class="item"><span class="dot" style="background:#eee"></span> ≈õnieg: <b id="snow">0</b></span>
        <span class="item pill">kilof: <b id="pick">podstawowy</b></span>
      </div>
      <div class="panel"><span id="fps">‚Äî FPS</span></div>
      <div id="menuWrap">
  <button id="menuBtn" class="topbtn" aria-haspopup="true" aria-expanded="false" title="Menu" aria-label="Menu g≈Ç√≥wne">‚â°</button>
        <div id="menuPanel" role="menu" aria-label="Menu" hidden tabindex="-1">
          <div class="hdr"><span class="ttl">Opcje</span><button id="menuCloseBtn" aria-label="Zamknij">√ó</button></div>
          <div class="group">
            <button id="mapBtn" class="topbtn" role="menuitem" title="Poka≈º ca≈ÇƒÖ mapƒô">Mapa: OFF</button>
            <button id="godBtn" class="topbtn" role="menuitem" title="Tryb boga (G)">B√≥g: OFF</button>
            <button id="centerBtn" class="topbtn" role="menuitem" title="Wy≈õrodkuj kamerƒô">Centruj</button>
            <button id="helpBtn" class="topbtn" role="menuitem" aria-controls="help" aria-expanded="false">Pomoc</button>
            <button id="radarMenuBtn" class="topbtn" role="menuitem" title="Radar diament√≥w">Radar üíé</button>
          </div>
          <div class="group seedRow"><label for="seedInput">Ziarno:</label><input id="seedInput" value="auto" /><button id="regenBtn">Nowy ≈õwiat</button></div>
          <div class="hint">Skr√≥ty: G=B√≥g, M=Mapa, C=Centrum, H=Pomoc</div>
          <div class="group" style="flex-direction:column; align-items:stretch; margin-top:4px;">
            <label style="font-size:12px; display:flex; justify-content:space-between; gap:8px; align-items:center;">Gƒôsto≈õƒá trawy <span id="grassDensityLabel">1.0</span></label>
            <input id="grassDensity" type="range" min="0" max="4" step="0.01" value="1" style="width:100%;" />
            <div class="hint">Reguluje liczbƒô ≈∫d≈∫be≈Ç / tile (skala logarytmiczna).</div>
          </div>
          <div class="group" style="flex-direction:column; align-items:stretch; margin-top:4px;">
            <label style="font-size:12px; display:flex; justify-content:space-between; gap:8px; align-items:center;">Wysoko≈õƒá trawy <span id="grassHeightLabel">1.0</span></label>
            <input id="grassHeight" type="range" min="0" max="2" step="0.01" value="1" style="width:100%;" />
            <div class="hint">Mno≈ºnik wysoko≈õci pojedynczych ≈∫d≈∫be≈Ç.</div>
          </div>
          <div class="group" style="flex-direction:column; align-items:stretch; margin-top:6px; border-top:1px solid rgba(255,255,255,.08); padding-top:6px;">
            <button id="openCust" class="topbtn" role="menuitem" title="Stylizacja postaci">Stylizacja‚Ä¶</button>
            <div class="hint">Otw√≥rz zaawansowanƒÖ stylizacjƒô (peleryny, oczy, stroje).</div>
          </div>
        </div>
      </div>
  <button id="lootInboxBtn" title="Nowe przedmioty (I)" aria-label="Nowe przedmioty">! <span id="lootInboxCount"></span></button>
    </div>
  <!-- topButtons replaced by dropdown menu; old markup removed -->
    <div id="craft">
      <strong>Rzemios≈Ço</strong>
      <button class="craftBtn" id="craftStone">Kilof kamienny</button><div class="req">10 √ó kamie≈Ñ</div>
      <button class="craftBtn" id="craftDiamond">Kilof diamentowy</button><div class="req">5 √ó diament</div>
    </div>
  <div id="help">Sterowanie: A/D lub ‚Üê/‚Üí ruch, W / ‚Üë / Spacja skok. LPM kopie (albo przycisk ‚õèÔ∏è), PPM stawia blok (wyb√≥r 4‚Äì9, 0). 1/2/3 wyb√≥r kilofa po craftingu. M (Mapa) ods≈Çania mg≈Çƒô. G (B√≥g) natychmiastowe kopanie. C centruje kamerƒô. H pomoc. Kierunek kopania (dla przycisku ‚õèÔ∏è) wybierz wok√≥≈Ç ‚õèÔ∏è. PodglƒÖd ducha bloku pokazuje gdzie mo≈ºesz postawiƒá. Ekwipunek i pasek szybkiego wyboru sƒÖ zapisywane automatycznie.</div>
    <div id="controls">
      <div class="pad" id="pad">
        <div></div><div data-key="ArrowUp" class="btn">‚Üë</div><div></div>
        <div data-key="ArrowLeft" class="btn">‚Üê</div><div class="btn" style="opacity:.25"></div><div data-key="ArrowRight" class="btn">‚Üí</div>
        <div></div><div data-key="ArrowDown" class="btn">‚Üì</div><div></div>
      </div>
    </div>
    <div id="dirRing">
      <div class="dircell"><button class="dirbtn" data-dx="-1" data-dy="-1">‚Üñ</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="0" data-dy="-1">‚Üë</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="1" data-dy="-1">‚Üó</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="-1" data-dy="0">‚Üê</button></div>
      <div class="dircell"><button id="mineBtn">‚õèÔ∏è</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="1" data-dy="0">‚Üí</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="-1" data-dy="1">‚Üô</button></div>
  <div class="dircell"><button class="dirbtn" data-dx="0" data-dy="1">‚Üì</button></div>
      <div class="dircell"><button class="dirbtn" data-dx="1" data-dy="1">‚Üò</button></div>
    </div>
    <button id="radarBtn" title="Radar diament√≥w (10√ó10)">üíé</button>
    <div id="messages"></div>
    <div id="hotbarWrap" aria-label="Pasek szybkiego wyboru blok√≥w">
      <div class="hotSlot" data-key="4" data-type="GRASS"><span class="key">4</span><span>trawa</span><span class="count" id="hotCntGRASS">0</span></div>
      <div class="hotSlot" data-key="5" data-type="SAND"><span class="key">5</span><span>piasek</span><span class="count" id="hotCntSAND">0</span></div>
      <div class="hotSlot" data-key="6" data-type="STONE"><span class="key">6</span><span>kamie≈Ñ</span><span class="count" id="hotCntSTONE">0</span></div>
      <div class="hotSlot" data-key="7" data-type="WOOD"><span class="key">7</span><span>drewno</span><span class="count" id="hotCntWOOD">0</span></div>
      <div class="hotSlot" data-key="8" data-type="LEAF"><span class="key">8</span><span>li≈õƒá</span><span class="count" id="hotCntLEAF">0</span></div>
  <div class="hotSlot" data-key="9" data-type="SNOW"><span class="key">9</span><span>≈õnieg</span><span class="count" id="hotCntSNOW">0</span></div>
  <div class="hotSlot" data-key="0" data-type="WATER"><span class="key">0</span><span>woda</span><span class="count" id="hotCntWATER">0</span></div>
    </div>
      <!-- Dynamic selection popover for remapping slot resource (includes chests in God mode) -->
    <div id="hotSelectMenu" style="position:absolute; display:none; z-index:1000; background:rgba(15,18,26,.96); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:6px 8px; box-shadow:0 8px 24px -4px rgba(0,0,0,.55); font-size:12px; min-width:170px; max-width:240px; pointer-events:auto;">
        <div style="font-weight:600; margin:2px 0 6px; opacity:.9">Wybierz typ</div>
        <div id="hotSelectOptions" style="display:flex; flex-direction:column; gap:4px;"></div>
        <div style="margin-top:6px; font-size:10px; opacity:.6;">Skrzynie dostƒôpne tylko w trybie Boga.</div>
      </div>
    <div id="errorBox" role="alert"></div>
  </div>
  <div id="lootDim"></div>
  <div id="lootPopup" role="dialog" aria-modal="true" aria-labelledby="lootTitle">
    <h3 id="lootTitle">Nowe przedmioty</h3>
    <div class="items" id="lootPopupItems"></div>
    <div class="btnBar"><button id="lootEquipAll" class="sec">Wyposa≈º najlepsze</button><button id="lootKeepAll" class="sec">Zachowaj wszystko</button><button id="lootClose" class="sec">Zamknij</button></div>
  </div>
  <script src="src/engine/constants.js"></script>
  <script src="src/engine/worldgen.js"></script>
  <script src="src/engine/world.js"></script>
  <script src="src/engine/trees.js"></script>
  <script src="src/engine/falling.js"></script>
  <script src="src/engine/water.js"></script>
  <script src="src/engine/cape.js"></script>
  <script src="src/engine/chests.js"></script>
  <script src="src/customization.js"></script>
  <script src="src/engine/mobs.js"></script>
  <script src="src/engine/background.js"></script>
  <script src="src/engine/fog.js"></script>
  <script src="src/engine/eyes.js"></script>
  <script src="src/engine/particles.js"></script>
  <script src="src/engine/grass.js"></script>
  <script src="src/engine/ui.js"></script>
  <script src="src/main.js"></script>

  <!-- Customization overlay -->
  <style>
    #custOverlay{ position:fixed; inset:0; background:rgba(5,8,14,.70); backdrop-filter:blur(10px); display:none; z-index:60; color:#eee; font-size:13px; }
    #custDialog{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:min(1000px,92vw); max-height:84vh; background:rgba(18,22,30,.95); border:1px solid rgba(255,255,255,.12); border-radius:18px; display:flex; gap:18px; padding:18px 20px 20px; box-shadow:0 12px 48px -8px rgba(0,0,0,.65); }
    #custLeft{ width:260px; display:flex; flex-direction:column; gap:14px; }
    #custPreviewWrap{ position:relative; background:linear-gradient(180deg,#0d131c,#1b2532); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:center; }
    #custPreview{ width:220px; height:220px; image-rendering:pixelated; }
    #custTabs{ display:flex; gap:8px; }
    .custTabBtn{ background:#2c7ef8; color:#fff; border:none; border-radius:999px; padding:6px 14px; font-weight:600; cursor:pointer; font-size:12px; }
    .custTabBtn.sel{ background:#21a366; }
    #custRight{ flex:1; display:flex; flex-direction:column; min-width:0; }
    #custGrid{ flex:1; display:grid; grid-template-columns:repeat(auto-fill,minmax(110px,1fr)); gap:10px; overflow:auto; padding-right:4px; }
    .custItem{ position:relative; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); border-radius:12px; padding:6px 6px 10px; display:flex; flex-direction:column; gap:4px; cursor:pointer; align-items:center; }
    .custItem.sel{ outline:2px solid #2c7ef8; }
    .custItem.locked{ filter:grayscale(.8) brightness(.6); cursor:not-allowed; }
    .custItem canvas{ width:80px; height:80px; image-rendering:pixelated; }
    .custItem .nm{ font-size:11px; font-weight:600; text-align:center; line-height:1.1; }
    #custHeader{ display:flex; align-items:center; justify-content:space-between; }
    #custClose{ background:rgba(255,255,255,.18); border:none; color:#fff; width:40px; height:40px; border-radius:12px; font-size:18px; cursor:pointer; }
    #custFooter{ margin-top:12px; display:flex; justify-content:space-between; font-size:11px; opacity:.8; }
  </style>
  <div id="custOverlay" role="dialog" aria-modal="true" aria-labelledby="custTitle">
    <div id="custDialog">
      <div id="custLeft">
        <div id="custHeader"><h2 id="custTitle" style="margin:0;font-size:18px;">Stylizacja</h2><button id="custClose" aria-label="Zamknij">√ó</button></div>
        <div id="custPreviewWrap"><canvas id="custPreview" width="220" height="220"></canvas></div>
        <div id="custTabs" role="tablist"></div>
        <div id="custFooter"><span id="custSelInfo">‚Äî</span><span>Auto‚Äëzapis</span></div>
        <div id="custStats" style="margin-top:10px; padding:8px 10px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); border-radius:8px; font-size:11px; line-height:1.4; max-height:150px; overflow:auto;">
          <strong>Aktualne statystyki</strong>
          <div id="custStatsBody" aria-live="polite"></div>
        </div>
      </div>
      <div id="custRight">
        <div id="custGrid" aria-label="Lista element√≥w"></div>
      </div>
    </div>
  </div>
</body>
</html>
